set(CMAKE_C_FLAGS ${CMAKE_C_FLAGS})

install(FILES "rdma.udev-rules" DESTINATION "${CMAKE_INSTALL_UDEV_RULESDIR}"
    RENAME "98-rdma.rules"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES "rdma.udev-ipoib-naming.rules" DESTINATION "${CMAKE_INSTALL_UDEV_RULESDIR}"
    RENAME "70-persistent-ipoib.rules"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

rdma_subst_install(FILES "rdma.service.in"
  DESTINATION "${CMAKE_INSTALL_SYSTEMD_SERVICEDIR}"
  RENAME "rdma.service"
  PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES rdma.conf DESTINATION "${CMAKE_INSTALL_SYSCONFDIR}/rdma/"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES rdma.sriov-vfs DESTINATION "${CMAKE_INSTALL_SYSCONFDIR}/rdma/"
    RENAME "sriov-vfs"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES rdma.mlx4.conf DESTINATION "${CMAKE_INSTALL_SYSCONFDIR}/rdma/"
    RENAME "mlx4.conf"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES rdma.fixup-mtrr.awk DESTINATION "${CMAKE_INSTALL_FULL_LIBEXECDIR}"
    RENAME "rdma-fixup-mtrr"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES rdma.mlx4-setup DESTINATION "${CMAKE_INSTALL_FULL_LIBEXECDIR}"
    RENAME "mlx4-setup"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ OWNER_EXECUTE GROUP_EXECUTE WORLD_EXECUTE)

rdma_subst_install(FILES rdma.kernel-init.in DESTINATION "${CMAKE_INSTALL_FULL_LIBEXECDIR}"
    RENAME "rdma-init-kernel"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ OWNER_EXECUTE GROUP_EXECUTE WORLD_EXECUTE)

if ("${DISTRO_FLAVOUR}" STREQUAL "Debian")
    file(MAKE_DIRECTORY "${CMAKE_INSTALL_SYSCONFDIR}/initramfs-tools/hooks/rdma/")
    rdma_subst_install(FILES rdma-initramfs-tools-hook.in DESTINATION "${CMAKE_INSTALL_SYSCONFDIR}/initramfs-tools/hooks/rdma"
        RENAME "rdma-initramfs-tools-hook"
        PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ OWNER_EXECUTE GROUP_EXECUTE WORLD_EXECUTE)
endif()

install(FILES rdma.sriov-init DESTINATION "${CMAKE_INSTALL_FULL_LIBEXECDIR}"
    RENAME "rdma-set-sriov-vf"
    PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ OWNER_EXECUTE GROUP_EXECUTE WORLD_EXECUTE)

install(FILES "rdma.cxgb3.sys.modprobe"
  DESTINATION "${CMAKE_INSTALL_LIBMODPROBE_DIR}"
  RENAME "cxgb3.conf"
  PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES "rdma.cxgb4.sys.modprobe"
  DESTINATION "${CMAKE_INSTALL_LIBMODPROBE_DIR}"
  RENAME "cxgb4.conf"
  PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES "rdma.mlx4.sys.modprobe.in"
  DESTINATION "${CMAKE_INSTALL_LIBMODPROBE_DIR}"
  RENAME "libmlx4.conf"
  PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)

install(FILES "rdma.mlx4.user.modprobe" DESTINATION "${CMAKE_INSTALL_SYSCONFDIR}/modprobe.d/"
  RENAME "mlx4.conf"
  PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)
