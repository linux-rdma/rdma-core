#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ(2.57)
AC_INIT(srptools, 0.0.4, openib-general@openib.org)
AC_CONFIG_SRCDIR(src/srp-dm.c)
AC_CONFIG_AUX_DIR(config)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(srptools, 0.0.4)

AC_ARG_ENABLE(libcheck, [  --disable-libcheck      do not test for presence of ib libraries],
[       if test x$enableval = xno ; then
                disable_libcheck=yes
        fi
])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.
if test "$disable_libcheck" != "yes"
then
AC_CHECK_LIB([ibcommon], [stack_dump], [],
	AC_MSG_ERROR([srptools require libibcommon.]))
AC_CHECK_LIB([ibumad], [umad_init], [],
	AC_MSG_ERROR([srptools require libibumad.]))
AC_CHECK_LIB([ibverbs], [ibv_get_device_list], [],
	AC_MSG_ERROR([srptools require libibverbs.]))
fi
AC_CHECK_LIB([pthread], [pthread_self], [],
	AC_MSG_ERROR([srptools require pthread.]))


# Checks for header files.
AC_HEADER_DIRENT
AC_HEADER_STDC
AC_CHECK_HEADERS(fcntl.h netinet/in.h stdint.h stdlib.h string.h sys/ioctl.h sys/time.h unistd.h)

# Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_C_INLINE
AC_TYPE_SIZE_T

# Checks for library functions.
AC_FUNC_CLOSEDIR_VOID
AC_PROG_GCC_TRADITIONAL
AC_FUNC_MALLOC
AC_FUNC_MEMCMP
AC_CHECK_FUNCS([memset strdup strndup strtol strtoull])

AC_CONFIG_FILES(Makefile)
AC_OUTPUT(srptools.spec)
